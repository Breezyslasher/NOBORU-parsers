Desu=Parser:new("Desu","https://desu.store","RUS","DESURU",8)Desu.Filters={{Name="Сортировка",Type="radio",Tags={"По алфавиту","По популярности","По обновлению"},Default="По популярности"},{Name="Тип манги",Type="check",Tags={"Манга","Манхва","Маньхуа","Ваншот","Комикс"}},{Name="Жанры",Type="check",Tags={"Безумие","Боевые искусства","Вампиры","Военное","Гарем","Демоны","Детектив","Детское","Дзёсей","Додзинси","Драма","Игры","Исторический","Комедия","Космос","Магия","Машины","Меха","Музыка","Пародия","Повседневность","Полиция","Приключения","Психологическое","Романтика","Самураи","Сверхъестественное","Сёдзе","Сёдзе Ай","Сейнен","Сёнен","Сёнен Ай","Смена пола","Спорт","Супер сила","Триллер","Ужасы","Фантастика","Фэнтези","Хентай","Школа","Экшен","Этти","Юри","Яой"}}}Desu.Keys={["По алфавиту"]="name",["По популярности"]="popular",["По обновлению"]="update",["Манга"]="manga",["Манхва"]="manhwa",["Маньхуа"]="manhua",["Ваншот"]="one_shot",["Комикс"]="comics",["Безумие"]="Dementia",["Боевые искусства"]="Martial Arts",["Вампиры"]="Vampire",["Военное"]="Military",["Гарем"]="Harem",["Демоны"]="Demons",["Детектив"]="Mystery",["Детское"]="Kids",["Дзёсей"]="Josei",["Додзинси"]="Doujinshi",["Драма"]="Drama",["Игры"]="Game",["Исторический"]="Historical",["Комедия"]="Comedy",["Космос"]="Space",["Магия"]="Magic",["Машины"]="Cars",["Меха"]="Mecha",["Музыка"]="Music",["Пародия"]="Parody",["Повседневность"]="Slice of Life",["Полиция"]="Police",["Приключения"]="Adventure",["Психологическое"]="Psychological",["Романтика"]="Romance",["Самураи"]="Samurai",["Сверхъестественное"]="Supernatural",["Сёдзе"]="Shoujo",["Сёдзе Ай"]="Shoujo Ai",["Сейнен"]="Seinen",["Сёнен"]="Shounen",["Сёнен Ай"]="Shounen Ai",["Смена пола"]="Gender Bender",["Спорт"]="Sports",["Супер сила"]="Super Power",["Триллер"]="Thriller",["Ужасы"]="Horror",["Фантастика"]="Sci-Fi",["Фэнтези"]="Fantasy",["Хентай"]="Hentai",["Школа"]="School",["Экшен"]="Action",["Этти"]="Ecchi",["Юри"]="Yuri",["Яой"]="Yaoi"}local a="https://desu.store/manga/api"local function b(c)local d={}Threads.insertTask(d,{Type="StringRequest",Link=c,Table=d,Index="string"})while Threads.check(d)do coroutine.yield(false)end;return d.string or""end;local function e(f)if u8c then return f:gsub("&#([^;]-);",function(g)local h=tonumber("0"..g)or tonumber(g)return h and u8c(h)or"&#"..g..";"end):gsub("&([^;]-);",function(g)return HTML_entities and HTML_entities[g]and u8c(HTML_entities[g])or"&"..g..";"end)else return f end end;function Desu:getManga(c,i,j)local k=b(c)i.NoPages=true;for l,m,n,o in k:gmatch('"id":%d-,"name":"(.-)","russian":"(.-)","image":.-:"([^"]-/preview/[^"]-)".-"url":".-(manga/%S-)"')do i[#i+1]=CreateManga(e((l.." ("..m..")"):gsub("\\","")),"/"..o,'',self.ID,self.Link.."/"..o)i.NoPages=false;coroutine.yield(false)end end;function Desu:getPopularManga(p,i)Desu:getManga(a.."?limit=50&order=popular&page="..p,i)end;function Desu:getAZManga(p,i)Desu:getManga(a.."?limit=50&order=name&page="..p,i)end;function Desu:getLatestManga(p,i)Desu:getManga(a.."?limit=50&order=updated&page="..p,i)end;function Desu:searchManga(q,p,i,r)local s=""if q:gsub(" ","")~=""then s=s.."&search="..q end;if r then s=s.."&order="..self.Keys[r[1]]local t={}for u,v in ipairs(r[2])do t[#t+1]=self.Keys[v]end;if#t>0 then s=s.."&kinds="..table.concat(t,",")end;local w={}for u,v in ipairs(r[3])do w[#w+1]=self.Keys[v]end;if#w>0 then s=s.."&genres="..table.concat(w,",")end end;Desu:getManga(a.."?limit=20&page="..p..s,i,true)end;function Desu:getChapters(x,i)local k=b(self.Link..x.Link)local y=(k:match('itemprop="description">(.-)</div>')or""):gsub("<.->",""):gsub("\n+","\n"):gsub("^%s+",""):gsub("%s+$","")i.Description=e(y)local z={}local A=k:match('<span class="rus%-name"[^>]->(.-)</span>')or""local B=k:match('<span class="name"[^>]->(.-)</span>')or x.Name;x.Name=e(B..(A==""and""or" ("..A..")"))for o,l in k:gmatch('<a href="(/?manga/%S-)" class="tips Tooltip"[^>]-title="([^>]-)">')do if o:sub(1,1)~="/"then o="/"..o end;z[#z+1]={Name=e(l),Link=o,Pages={},Manga=x}end;for C=#z,1,-1 do i[#i+1]=z[C]end end;function Desu:prepareChapter(D,i)local k=b(self.Link..D.Link)local E=((k:match('dir: "([^"]-)",')or""):gsub("^[\\/]*","")or""):gsub("\\/","/")or""local F=k:match("images: %[%[(.-)%]%],")or""for c in F:gmatch('"(.-)"')do i[#i+1]=E..c end end;function Desu:loadChapterPage(c,i)i.Link={Link=c,Header1="Referer:"..self.Link}end