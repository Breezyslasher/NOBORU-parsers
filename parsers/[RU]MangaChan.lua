MangaChan=Parser:new("Манга-Тян!","https://im.manga-chan.me","RUS","MANGACHANRU",3)local function a(b)if u8c then return b:gsub("&#([^;]-);",function(c)local d=tonumber("0"..c)or tonumber(c)return d and u8c(d)or"&#"..c..";"end):gsub("&([^;]-);",function(c)return HTML_entities and HTML_entities[c]and u8c(HTML_entities[c])or"&"..c..";"end)else return b end end;function MangaChan:downloadContent(e)local f={}Threads.insertTask(f,{Type="StringRequest",Link=e,Table=f,Index="string"})while Threads.check(f)do coroutine.yield(false)end;return f.string or""end;function MangaChan:getManga(e,g)local h=self:downloadContent(e)g.NoPages=true;for i,j,k in h:gmatch('content_row" title=".-href=[\'"][^\'"]-/manga/([^\'"]-)%.html[\'"]>.-<img[^>]-src="([^"]-)".-manga_row1.-title_link">(.-)</a>')do g[#g+1]=CreateManga(a(k):gsub("<[^>]+>",""):gsub("%s+"," "),i,j:gsub("%%","%%%%"),self.ID,self.Link.."/manga/"..i..".html",self.Link.."/manga/"..i..".html")g.NoPages=false;coroutine.yield(false)end end;function MangaChan:getPopularManga(l,g)self:getManga(self.Link.."/mostfavorites?offset="..(l-1)*20,g)end;function MangaChan:getLatestManga(l,g)self:getManga(self.Link.."/manga/new?offset="..(l-1)*20,g)end;function MangaChan:searchManga(m,l,g)local h=self:downloadContent(self.Link.."/index.php?do=search&subaction=search&search_start=1&full_search=0&result_from="..1+(l-1)*40 .."&result_num=40&story="..m.."&need_sort_date=false")g.NoPages=true;for j,i,k in h:gmatch('content_row"%s*title=".-<img src="([^"]-)".-manga_row1.-href=[\'"][^\'"]-/manga/([^\'"]-)%.html[\'"]%s*>([^>]-)</a>')do g[#g+1]=CreateManga(a(k):gsub("%s+"," "),i,j:gsub("%%","%%%%"),self.ID,self.Link.."/manga/"..i..".html",self.Link.."/manga/"..i..".html")g.NoPages=false;coroutine.yield(false)end end;function MangaChan:getChapters(n,g)local h=self:downloadContent(self.Link.."/manga/"..n.Link..".html")local o=(h:match('id="description" style.->(.-)<div')or""):gsub("<br[^>]->","\n"):gsub("<.->",""):gsub("\n+","\n"):gsub("^%s+",""):gsub("%s+$","")g.Description=a(o):gsub("<[^>]+>","")local p={}for i,k in h:gmatch("href='[^']-/online/([^']-).html' title='[^']-'>(.-)</span>")do p[#p+1]={Name=a(k):gsub("%s+"," "),Link=i,Pages={},Manga=n}end;for q=#p,1,-1 do g[#g+1]=p[q]end end;function MangaChan:prepareChapter(r,g)local h=self:downloadContent(self.Link.."/online/"..r.Link..".html"):match('"fullimg"%s*:%s*%[(.-)%]')or""for e in h:gmatch('"([^"]-)"')do g[#g+1]={Link=e:gsub("\\/","/"):gsub("%%","%%%%"),Header1="Referer: "..self.Link}end end;function MangaChan:loadChapterPage(e,g)g.Link=e end;YaoiChan=MangaChan:new("Яой-Тян!","https://v8.yaoi-chan.me","RUS","YAOICHANRU",3)YaoiChan.NSFW=true;function YaoiChan:getPopularManga(l,g)self:getManga(self.Link.."/manga/new?offset="..(l-1)*20,g)end;HentaiChan=MangaChan:new("Хентай-Тян!","https://x2.h-chan.me","RUS","HENTAICHANRU",6)HentaiChan.NSFW=true;function HentaiChan:downloadContent(e)local f={}Threads.insertTask(f,{Type="StringRequest",Link=e,Table=f,Index="string",Cookie="dle_restore_pass11=1"})while Threads.check(f)do coroutine.yield(false)end;return f.string or""end;local s="http://exhentai-dono.me"function HentaiChan:getChapters(n,g)local h=self:downloadContent(self.Link.."/related/"..n.Link..".html")n.NewImageLink=h:match('<img id="cover" src="(.-)"')or""if n.NewImageLink==""then n.NewImageLink=nil end;if h:match('<p class="extra_on">Все главы</p>')or h:match('<p class="extra_on">Все части</p>')then local p={}local t=0;while true do local u=false;for i,k in h:gmatch('related_info">.-href="[^"]*/manga/([^"]-)%.html"[^>]->(.-)<')do u=true;p[#p+1]={Name=a(k),Link=i,Pages={},Manga=n}end;coroutine.yield(true)if not u then break end;t=t+20;h=self:downloadContent(self.Link.."/related/"..n.Link..".html?offset="..t)end;for q=1,#p do g[q]=p[q]end else local v={Name=a(n.Name),Link=n.Link,Pages={},Manga=n}g[#g+1]=v end end;function HentaiChan:prepareChapter(r,g)local h=self:downloadContent(s.."/online/"..r.Link..".html?development_access=true"):match('"fullimg"%s*:%s*%[(.-)%]')or""for e in h:gmatch("'([^']-)'")do g[#g+1]={Link=e:gsub("\\/","/"):gsub("%%","%%%%"),Header1="Referer: "..self.Link}end end;function HentaiChan:loadChapterPage(e,g)g.Link=e end